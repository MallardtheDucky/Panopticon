<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ISB // DIRECTORATE // KRASK // SECURE</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100;300;400;700;800&family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&family=Teko:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --imp-white: #e5e5e5;
            --imp-gray: #4a4a4a;
            --imp-dark: #0a0a0a;
            --imp-black: #020202;
            --imp-red: #bb1e1e;
            --imp-red-dim: #5c0a0a;
            --imp-amber: #ffae00;
        }

        body {
            background-color: var(--imp-black);
            color: var(--imp-white);
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
            margin: 0;
            padding: 0;
            cursor: crosshair;
        }

        /* --- TYPOGRAPHY --- */
        .font-header { font-family: 'Teko', sans-serif; letter-spacing: 0.15em; }
        .font-tech { font-family: 'Share Tech Mono', monospace; }
        .font-mono-bold { font-family: 'JetBrains Mono', monospace; font-weight: 800; }

        /* --- CRT EFFECTS --- */
        .crt-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 50;
        }

        .scanline {
            width: 100%;
            height: 100px;
            z-index: 51;
            background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(255, 255, 255, 0.04) 50%, rgba(0,0,0,0) 100%);
            opacity: 0.1;
            position: absolute;
            bottom: 100%;
            animation: scanline 8s linear infinite;
            pointer-events: none;
        }

        @keyframes scanline {
            0% { bottom: 100%; }
            100% { bottom: -100px; }
        }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #050505; border-left: 1px solid #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #333; border: 1px solid #000; }
        ::-webkit-scrollbar-thumb:hover { background: var(--imp-red); }

        /* --- UTILITIES --- */
        .text-glow { text-shadow: 0 0 5px rgba(229, 229, 229, 0.3); }
        .bg-grid-pattern {
            background-size: 40px 40px;
            background-image:
                linear-gradient(to right, rgba(50, 50, 50, 0.1) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(50, 50, 50, 0.1) 1px, transparent 1px);
        }
        
        /* STATIC NOISE ANIMATION */
        .noise-bg {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.1'/%3E%3C/svg%3E");
        }
        .animate-noise { animation: noise-shift 0.2s steps(3) infinite; }
        @keyframes noise-shift {
            0% { background-position: 0 0; }
            100% { background-position: 100% 100%; }
        }

        /* Animations */
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .ticker-content { animation: ticker 60s linear infinite; }
        
        .cursor-blink::after { content: '█'; animation: blink 1s step-end infinite; color: var(--imp-red); margin-left: 4px; }
        @keyframes blink { 50% { opacity: 0; } }

        /* Custom Range Slider */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; background: var(--imp-white); cursor: pointer; margin-top: -6px; border: 1px solid #000; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #333; }
        input[type=range]:focus { outline: none; }
        
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-slide-in { animation: slideIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // ==========================================
        // DATA & LORE
        // ==========================================
        
        const LORE = {
            director: "DIRECTOR VALEN KRASK",
            id: "ISB-CEN-001",
            clearance: "CLE-10 // IMPERIAL EYES ONLY",
            location: "ISB CENTRAL TOWER // CORUSCANT // 'THE IVORY TOWER'",
            date: "5 ABY // CYCLE 144",
            project: "COMPREHENSIVE SOCIAL EQUILIBRIUM",
            code: "PANOPTICON",
            target: "HOK (OVERSECTOR 4)",
            motto: "ORDER IS MERCY. CHAOS IS CRUELTY."
        };

        const SECTORS = [
            { id: 'MINING', name: 'MINING DISTRICT 7G', x: 20, y: 30, risk: 92, output: 45, detail: "Guild 442 Strike imminent. Leader 'Kalen' flagged for behavioral review." },
            { id: 'IND', name: 'INDUSTRIAL CORE', x: 45, y: 50, risk: 60, output: 95, detail: "Refinery output nominal. Quota pressures increasing stress metrics." },
            { id: 'GOV', name: 'ADMINISTRATIVE ZONE', x: 70, y: 30, risk: 15, output: 100, detail: "Grand Moff Kessler's residence. High security. Reformist stronghold." },
            { id: 'PORT', name: 'SPACEPORT ALPHA', x: 60, y: 70, risk: 75, output: 80, detail: "Smuggling vectors identified. Cargo checks failing due to bribery." },
            { id: 'EDU', name: 'UNIVERSITY DISTRICT', x: 30, y: 60, risk: 55, output: 20, detail: "Ideological drift detected. History Dept. professors under surveillance." }
        ];

        // ==========================================
        // UI COMPONENTS
        // ==========================================

        const Box = ({ children, className = "", title, alert = false, fit = false, scroll = false, glowing = false, noBorder = false }) => (
            <div className={`relative bg-zinc-950/90 ${noBorder ? '' : 'border'} ${alert ? 'border-red-900 shadow-[0_0_10px_rgba(185,28,28,0.1)]' : 'border-zinc-800'} ${className} flex flex-col backdrop-blur-sm transition-colors duration-500`}>
                {!noBorder && (
                    <>
                        <div className={`absolute -top-[1px] -left-[1px] w-2 h-2 border-t-2 border-l-2 ${alert ? 'border-red-600' : 'border-zinc-500'}`}></div>
                        <div className={`absolute -bottom-[1px] -right-[1px] w-2 h-2 border-b-2 border-r-2 ${alert ? 'border-red-600' : 'border-zinc-500'}`}></div>
                    </>
                )}
                
                {title && (
                    <div className={`flex items-center justify-between px-3 py-1.5 border-b ${alert ? 'border-red-900 bg-red-950/20' : 'border-zinc-800 bg-zinc-900/40'} shrink-0`}>
                        <span className={`text-[10px] tracking-[0.2em] font-header uppercase ${alert ? 'text-red-500' : 'text-zinc-400'}`}>
                            {title}
                        </span>
                        <div className="flex gap-1">
                            <div className={`w-1 h-1 ${alert ? 'bg-red-500 animate-pulse' : 'bg-zinc-600'}`}></div>
                        </div>
                    </div>
                )}
                
                <div className={`relative ${fit ? '' : 'p-4 flex-1'} ${scroll ? 'overflow-y-auto custom-scroll' : 'overflow-hidden'}`}>
                    {children}
                </div>
            </div>
        );

        const LoadingBar = ({ progress, color = "bg-white", height = "h-1", animated = false }) => (
            <div className={`w-full bg-zinc-900 ${height} overflow-hidden relative`}>
                <div className={`absolute top-0 left-0 bottom-0 ${color} transition-all duration-1000 ${animated ? 'animate-pulse' : ''}`} style={{ width: `${progress}%` }}></div>
                <div className="absolute inset-0 bg-[url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQIW2NkQAKrVq36zwjjgzhhYWGMYAEYB8RmROaABADeOQ8CXl/xfgAAAABJRU5ErkJggg==')] opacity-30"></div>
            </div>
        );

        const Button = ({ children, onClick, active = false, alert = false, className = "", disabled = false }) => (
            <button 
                onClick={onClick}
                disabled={disabled}
                className={`
                    relative px-3 py-1.5 text-[10px] font-tech uppercase tracking-wider transition-all duration-200
                    border focus:outline-none flex items-center justify-center gap-2
                    ${active 
                        ? (alert ? 'bg-red-950/60 border-red-500 text-red-500' : 'bg-zinc-800 border-zinc-400 text-white') 
                        : (alert ? 'border-red-900/50 text-red-900 hover:border-red-500 hover:text-red-500' : 'border-zinc-800 text-zinc-500 hover:text-zinc-300 hover:border-zinc-600')
                    }
                    ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}
                    ${className}
                `}
            >
                {children}
            </button>
        );

        const Typewriter = ({ text, speed = 10, onComplete }) => {
            const [display, setDisplay] = useState('');
            useEffect(() => {
                setDisplay('');
                let i = 0;
                const timer = setInterval(() => {
                    if (i < text.length) {
                        setDisplay(prev => prev + text.charAt(i));
                        i++;
                    } else {
                        clearInterval(timer);
                        if(onComplete) onComplete();
                    }
                }, speed);
                return () => clearInterval(timer);
            }, [text, speed]);
            return <span>{display}</span>;
        };

        const RadarChart = ({ stability, fear }) => {
            // Simplified dynamic radar for visual effect
            const s = stability / 100;
            const f = fear / 100;
            
            const p1 = `${50},${10 + (1-s)*40}`; // Fear (Top)
            const p2 = `${90 - (1-f)*40},${50}`; // Dependency (Right)
            const p3 = `${50},${90 - (1-s)*40}`; // Compliance (Bottom)
            const p4 = `${10 + (1-f)*40},${50}`; // Resistance (Left)
            
            return (
                <div className="relative w-full h-full flex items-center justify-center">
                    <svg viewBox="0 0 100 100" className="w-3/4 h-3/4 overflow-visible">
                        <polygon points="50,0 100,50 50,100 0,50" fill="none" stroke="#333" strokeWidth="1" />
                        <line x1="50" y1="0" x2="50" y2="100" stroke="#333" strokeWidth="0.5" />
                        <line x1="0" y1="50" x2="100" y2="50" stroke="#333" strokeWidth="0.5" />
                        
                        <polygon points={`${p1} ${p2} ${p3} ${p4}`} fill="rgba(185, 28, 28, 0.4)" stroke="#b91c1c" strokeWidth="1" className="transition-all duration-1000 ease-in-out" />
                    </svg>
                    <div className="absolute top-0 text-[8px] text-zinc-500">FEAR</div>
                    <div className="absolute bottom-0 text-[8px] text-zinc-500">COMPLIANCE</div>
                    <div className="absolute left-0 text-[8px] text-zinc-500">RESISTANCE</div>
                    <div className="absolute right-0 text-[8px] text-zinc-500">DEPENDENCY</div>
                </div>
            )
        }

        const LineChart = ({ data, color = "#fff", height = 60 }) => {
            // Normalize data
            const max = Math.max(...data);
            const min = Math.min(...data);
            const points = data.map((val, i) => {
                const x = (i / (data.length - 1)) * 100;
                const y = 100 - ((val - min) / (max - min || 1)) * 100;
                return `${x},${y}`;
            }).join(' ');

            return (
                <svg viewBox="0 0 100 100" preserveAspectRatio="none" className="w-full h-full overflow-visible">
                    <polyline points={points} fill="none" stroke={color} strokeWidth="2" vectorEffect="non-scaling-stroke" />
                    <circle cx={data.length > 0 ? "100" : "0"} cy={100 - ((data[data.length-1] - min) / (max - min || 1)) * 100} r="2" fill={color} className="animate-pulse" />
                </svg>
            );
        };

        const BarChart = ({ data, labels }) => {
            return (
                <div className="flex items-end justify-between h-full gap-2 pt-4 pb-2">
                    {data.map((val, i) => (
                        <div key={i} className="flex-1 flex flex-col justify-end items-center h-full group">
                             <div className="text-[9px] font-mono text-white mb-1 opacity-0 group-hover:opacity-100 transition-opacity">{val}%</div>
                            <div className="w-full bg-zinc-900 relative h-full flex items-end">
                                <div 
                                    className={`w-full transition-all duration-1000 ${val > 80 ? 'bg-red-600' : 'bg-zinc-500'}`} 
                                    style={{ height: `${val}%` }}
                                ></div>
                            </div>
                            <div className="text-[8px] font-mono text-zinc-500 mt-2 rotate-0 truncate w-full text-center">{labels[i]}</div>
                        </div>
                    ))}
                </div>
            );
        };

        // ==========================================
        // PAGE MODULES
        // ==========================================

        // --- NEW MODULE: ANALYTICS SUITE ---
        const Analytics = () => {
             const [history, setHistory] = useState([65, 68, 70, 72, 69, 65, 62, 58, 60, 63, 67, 72, 75]);
             const [resourceData, setResourceData] = useState([45, 80, 20, 95, 60]);
             
             // Simulate live data
             useEffect(() => {
                 const interval = setInterval(() => {
                     setHistory(prev => {
                         const newVal = prev[prev.length-1] + (Math.random() > 0.5 ? 2 : -2);
                         return [...prev.slice(1), Math.min(100, Math.max(0, newVal))];
                     });
                     setResourceData(prev => prev.map(v => Math.min(100, Math.max(0, v + (Math.random() * 4 - 2)))));
                 }, 2000);
                 return () => clearInterval(interval);
             }, []);

             return (
                 <div className="h-full flex flex-col gap-6 animate-slide-in">
                     <div className="grid grid-cols-2 gap-6 h-1/2">
                        <Box title="GLOBAL_STABILITY_INDEX // 24H_TREND" className="h-full" glowing>
                            <div className="flex flex-col h-full p-4">
                                <div className="flex justify-between items-end mb-4">
                                    <div className="text-4xl font-header text-white">{Math.round(history[history.length-1])}%</div>
                                    <div className="text-xs font-mono text-zinc-500">PROJECTED: <span className="text-green-500">+2.4%</span></div>
                                </div>
                                <div className="flex-1 border-l border-b border-zinc-800 relative">
                                    <div className="absolute inset-0 p-2">
                                        <LineChart data={history} color="#10b981" />
                                    </div>
                                    {/* Grid Lines */}
                                    <div className="absolute top-1/4 w-full h-px bg-zinc-800/50"></div>
                                    <div className="absolute top-2/4 w-full h-px bg-zinc-800/50"></div>
                                    <div className="absolute top-3/4 w-full h-px bg-zinc-800/50"></div>
                                </div>
                            </div>
                        </Box>
                        <Box title="SECTOR_OUTPUT_COMPARISON" className="h-full">
                            <div className="h-full p-6">
                                <BarChart 
                                    data={resourceData} 
                                    labels={['MINING', 'PORT', 'EDU', 'IND', 'GOV']} 
                                />
                            </div>
                        </Box>
                     </div>
                     <div className="h-1/2 flex gap-6">
                         <Box title="CYCLE_EFFICIENCY" className="w-1/3">
                             <div className="h-full flex items-center justify-center p-4">
                                 <div className="w-32 h-32 rounded-full border-8 border-zinc-800 border-t-red-600 border-r-red-600 rotate-45 flex items-center justify-center">
                                     <div className="text-center">
                                         <div className="text-2xl font-header text-white">74%</div>
                                         <div className="text-[9px] font-mono text-zinc-500">EFFICIENCY</div>
                                     </div>
                                 </div>
                             </div>
                         </Box>
                         <Box title="REALTIME_LOGS" className="flex-1" scroll>
                             <div className="font-mono text-[10px] space-y-1 text-zinc-400">
                                 {history.map((h, i) => (
                                     <div key={i} className="flex justify-between border-b border-zinc-900 pb-1">
                                         <span className="text-zinc-600">CYCLE_144.{i}</span>
                                         <span>STABILITY_METRIC_UPDATE :: {Math.round(h)} :: <span className="text-green-600">OK</span></span>
                                     </div>
                                 ))}
                             </div>
                         </Box>
                     </div>
                 </div>
             )
        }

        // --- NEW MODULE: SURVEILLANCE GRID ---
        const Surveillance = () => {
            const cameras = [
                { id: 'CAM-01', loc: 'MINING_FLOOR_B', status: 'ACTIVE', noise: false },
                { id: 'CAM-02', loc: 'PORT_DOCK_4', status: 'NO SIGNAL', noise: true },
                { id: 'CAM-03', loc: 'GOV_PLAZA', status: 'ACTIVE', noise: false },
                { id: 'CAM-04', loc: 'UNI_HALL_A', status: 'ACTIVE', noise: false },
                { id: 'CAM-05', loc: 'SECTOR_7G_PERIMETER', status: 'OFFLINE', noise: false },
                { id: 'CAM-06', loc: 'ISB_DETENTION', status: 'ACTIVE', noise: false },
            ];

            return (
                <div className="h-full animate-slide-in grid grid-cols-3 grid-rows-2 gap-4">
                    {cameras.map(cam => (
                        <Box key={cam.id} title={`${cam.id} // ${cam.loc}`} className="relative overflow-hidden group" noBorder>
                            {/* Feed Content */}
                            <div className="absolute inset-0 bg-zinc-900 flex items-center justify-center overflow-hidden">
                                {cam.status === 'ACTIVE' && (
                                    <>
                                        <div className="w-full h-full opacity-20 bg-[repeating-linear-gradient(0deg,transparent,transparent_1px,#000_1px,#000_2px)]"></div>
                                        <div className="absolute inset-0 flex items-center justify-center">
                                            <div className="w-64 h-64 border border-zinc-700 rounded-full opacity-20 animate-pulse"></div>
                                            <div className="absolute top-1/2 left-1/2 w-2 h-2 bg-red-500 rounded-full animate-ping"></div>
                                        </div>
                                        {/* Mock Scene */}
                                        <div className="absolute bottom-4 left-4 right-4 h-16 border-t border-zinc-700 flex justify-around items-end pb-2">
                                            <div className="w-8 h-12 bg-zinc-800"></div>
                                            <div className="w-12 h-8 bg-zinc-800"></div>
                                            <div className="w-8 h-16 bg-zinc-800"></div>
                                        </div>
                                    </>
                                )}
                                {cam.noise && <div className="absolute inset-0 noise-bg animate-noise opacity-50"></div>}
                                {cam.status !== 'ACTIVE' && (
                                    <div className="z-10 bg-black/80 px-4 py-2 border border-red-900 text-red-500 font-header tracking-widest animate-pulse">
                                        {cam.status}
                                    </div>
                                )}
                            </div>
                            
                            {/* Overlay UI */}
                            <div className="absolute inset-0 p-2 pointer-events-none flex flex-col justify-between">
                                <div className="flex justify-between items-start">
                                    <div className="text-[9px] font-mono text-red-500 bg-black/50 px-1">REC ●</div>
                                    <div className="text-[9px] font-mono text-zinc-400">{new Date().toLocaleTimeString()}</div>
                                </div>
                                <div className="flex justify-between items-end">
                                    <div className="text-[8px] font-mono text-zinc-600">ISO 800 / F2.4</div>
                                    <div className="w-16 h-8 border-l border-b border-zinc-600 opacity-50"></div>
                                </div>
                            </div>
                            
                            {/* Scanline */}
                            <div className="absolute inset-0 pointer-events-none opacity-10 bg-gradient-to-b from-transparent via-white to-transparent h-4 w-full animate-[scanline_3s_linear_infinite]"></div>
                        </Box>
                    ))}
                </div>
            )
        }

        // --- NEW MODULE: TERMINAL ---
        const Terminal = ({ onCommand }) => {
            const [history, setHistory] = useState([
                "ISB-OS v4.2.1 [SECURE TERMINAL]",
                "Type 'HELP' for available commands."
            ]);
            const [input, setInput] = useState("");
            const bottomRef = useRef(null);

            useEffect(() => { bottomRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [history]);

            const handleCommand = (e) => {
                if (e.key === 'Enter') {
                    const cmd = input.trim().toUpperCase();
                    let response = "";
                    let triggerAction = null;
                    
                    if (cmd === 'HELP') {
                        response = "COMMANDS: ALERT [LEVEL], VIEW [PAGE], SCAN, PURGE, AUTHORIZE [PROTOCOL], DEPLOY [UNIT], OVERRIDE [TARGET], WHOAMI, CLEAR";
                    } else if (cmd.startsWith('ALERT')) {
                        const level = cmd.split(' ')[1];
                        if (['HIGH', 'LOW', 'CRITICAL'].includes(level)) {
                            response = `GLOBAL ALERT LEVEL SET TO: ${level}`;
                            triggerAction = { type: 'ALERT', payload: level };
                        } else {
                            response = "ERROR: INVALID ALERT LEVEL. USE: HIGH, LOW";
                        }
                    } else if (cmd.startsWith('VIEW')) {
                        const page = cmd.split(' ')[1]?.toLowerCase();
                        if (page) {
                            response = `NAVIGATING TO MODULE: ${page}`;
                            triggerAction = { type: 'NAVIGATE', payload: page };
                        } else {
                            response = "ERROR: SPECIFY MODULE ID";
                        }
                    } else if (cmd === 'SCAN') {
                        response = "SCANNING SECTOR 7G... [||||||----] 60% COMPLETE. ANOMALY DETECTED IN MINING DISTRICT.";
                    } else if (cmd.startsWith('OVERRIDE')) {
                        if (cmd.includes('KESSLER')) {
                            response = "OVERRIDING GRAND MOFF AUTHORITY... DONE. ARTICLE 4 EMERGENCY POWERS ACTIVE.";
                            triggerAction = { type: 'ALERT', payload: 'HIGH' };
                        } else {
                            response = "ERROR: TARGET REQUIRED.";
                        }
                    } else if (cmd.startsWith('DEPLOY')) {
                        response = "GARRISON UNIT DISPATCHED TO SECTOR 7G. FEAR METRICS RISING.";
                        triggerAction = { type: 'FEAR_SPIKE', payload: 10 };
                    } else if (cmd.startsWith('AUTHORIZE')) {
                         if (cmd.includes('PANOPTICON') || cmd.includes('PHASE_II')) {
                             response = "AUTHORIZATION ACCEPTED. PHASE II PROTOCOLS UNLOCKED. KESSLER BYPASSED.";
                             triggerAction = { type: 'UNLOCK', payload: 'PHASE_II' };
                         } else {
                             response = "ERROR: INSUFFICIENT CLEARANCE CODE.";
                         }
                    } else if (cmd === 'WHOAMI') {
                        response = "USER: DIRECTOR VALEN KRASK. CLEARANCE: 10. ID: ISB-CEN-001. ALIAS: 'THE PHYSICIAN'.";
                    } else if (cmd === 'CLEAR') {
                        setHistory([]);
                        setInput("");
                        return;
                    } else {
                        response = `UNKNOWN COMMAND: '${cmd}'`;
                    }

                    setHistory(prev => [...prev, `> ${input}`, response]);
                    setInput("");
                    if (triggerAction && onCommand) onCommand(triggerAction);
                }
            };

            return (
                <div className="h-full flex flex-col animate-slide-in">
                    <Box title="COMMAND_LINE_INTERFACE // ROOT_ACCESS" className="h-full font-mono text-sm" glowing>
                        <div className="flex flex-col h-full bg-black p-4 overflow-hidden">
                            <div className="flex-1 overflow-y-auto custom-scroll space-y-2 mb-4">
                                {history.map((line, i) => (
                                    <div key={i} className={`${line.startsWith('>') ? 'text-zinc-500' : 'text-green-500'}`}>
                                        {line}
                                    </div>
                                ))}
                                <div ref={bottomRef}></div>
                            </div>
                            <div className="flex items-center gap-2 border-t border-zinc-800 pt-2">
                                <span className="text-red-500">{">"}</span>
                                <input 
                                    type="text" 
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    onKeyDown={handleCommand}
                                    className="flex-1 bg-transparent border-none outline-none text-white font-mono uppercase focus:ring-0"
                                    placeholder="AWAITING_INPUT..."
                                    autoFocus
                                />
                            </div>
                        </div>
                    </Box>
                </div>
            );
        };

        // --- NEW MODULE: BEHAVIORAL MODIFICATION ("THE PHYSICIAN") ---
        const BehavioralMod = ({ onIntervention }) => {
            const [subject, setSubject] = useState(null);
            const [step, setStep] = useState('SELECT'); // SELECT, ANALYZE, INTERVENE, RESULT
            const [intervention, setIntervention] = useState(null);

            const subjects = [
                { id: 'SUB-892', name: 'PROF. J. CORRAN', role: 'History Dept. Head', risk: 65, traits: ['Nostalgic', 'Influential', 'Tenure'], status: 'ACTIVE' },
                { id: 'SUB-441', name: 'KALEN VOS', role: 'Guild 442 Lead', risk: 92, traits: ['Charismatic', 'Volatile', 'Connected'], status: 'ACTIVE' },
                { id: 'SUB-112', name: 'ADM. T. RANE', role: 'Port Authority', risk: 45, traits: ['Corrupt', 'Greedy', 'Cowardly'], status: 'ACTIVE' }
            ];

            const interventions = [
                { id: 'ECO', name: 'ECONOMIC PRESSURE', desc: 'Restrict credit. Deny grants. Create bureaucratic debt.', cost: 'LOW', impact: 'SUBTLE', fearBonus: 5, stabBonus: 2 },
                { id: 'SOC', name: 'SOCIAL ISOLATION', desc: 'Fabricate rumors. Distance colleagues. Algorithmically suppress comms.', cost: 'MED', impact: 'MODERATE', fearBonus: 10, stabBonus: 5 },
                { id: 'DET', name: 'PREVENTIVE DETENTION', desc: 'Immediate extraction. Enhanced interrogation.', cost: 'HIGH', impact: 'SEVERE', fearBonus: 25, stabBonus: 10 }
            ];

            const handleIntervene = (type) => {
                setIntervention(type);
                setStep('RESULT');
                if (onIntervention) onIntervention(type.fearBonus, type.stabBonus);
            };

            const reset = () => {
                setSubject(null);
                setStep('SELECT');
                setIntervention(null);
            }

            return (
                <div className="h-full flex gap-6 animate-slide-in">
                    <div className="w-1/3 flex flex-col gap-4">
                        <Box title="SUBJECT_QUEUE" className="flex-1" scroll>
                            <div className="space-y-2">
                                {subjects.map(s => (
                                    <button 
                                        key={s.id} 
                                        onClick={() => { setSubject(s); setStep('ANALYZE'); }}
                                        className={`w-full text-left p-3 border transition-all ${subject?.id === s.id ? 'bg-white text-black border-white' : 'bg-zinc-900 border-zinc-800 hover:border-zinc-500 text-zinc-400'}`}
                                    >
                                        <div className="flex justify-between items-center mb-1">
                                            <span className="font-header text-lg">{s.name}</span>
                                            <span className={`text-xs font-mono ${s.risk > 80 ? 'text-red-500' : 'text-amber-500'}`}>{s.risk}% RISK</span>
                                        </div>
                                        <div className="text-[10px] font-mono opacity-70">{s.role}</div>
                                    </button>
                                ))}
                            </div>
                        </Box>
                        <Box title="DOCTRINE" className="h-1/3 p-4">
                            <div className="text-xs font-mono text-zinc-400 italic">"We do not wait for the disease to kill the patient. We intervene early. We treat the symptom before it becomes a condition."</div>
                            <div className="text-[10px] font-mono text-zinc-600 mt-2 text-right">- THE PHYSICIAN</div>
                        </Box>
                    </div>

                    <div className="flex-1">
                        <Box title="INTERVENTION_CONSOLE" className="h-full" glowing={step === 'ANALYZE'}>
                            {step === 'SELECT' && (
                                <div className="h-full flex items-center justify-center opacity-50">
                                    <div className="text-center">
                                        <div className="text-4xl mb-2">⚕</div>
                                        <div className="text-xs font-mono tracking-widest">SELECT PATIENT FOR EVALUATION</div>
                                    </div>
                                </div>
                            )}

                            {step === 'ANALYZE' && subject && (
                                <div className="h-full flex flex-col animate-fade-in">
                                    <div className="flex justify-between items-start mb-6 border-b border-zinc-800 pb-4">
                                        <div>
                                            <div className="text-xs font-mono text-zinc-500">SUBJECT ID: {subject.id}</div>
                                            <div className="text-3xl font-header text-white">{subject.name}</div>
                                            <div className="text-sm font-mono text-red-400">{subject.role}</div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-4xl font-header text-red-500">{subject.risk}%</div>
                                            <div className="text-[9px] font-mono text-zinc-500">THREAT INDEX</div>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-3 gap-4 mb-8">
                                        {subject.traits.map(t => (
                                            <div key={t} className="p-2 border border-zinc-700 bg-zinc-900 text-center text-xs font-mono text-zinc-300">{t}</div>
                                        ))}
                                    </div>

                                    <div className="flex-1">
                                        <div className="text-xs font-mono text-zinc-500 uppercase mb-4">Select Treatment Protocol</div>
                                        <div className="grid grid-cols-1 gap-3">
                                            {interventions.map(int => (
                                                <button 
                                                    key={int.id}
                                                    onClick={() => handleIntervene(int)}
                                                    className="group flex items-center justify-between p-4 border border-zinc-800 hover:border-red-500 hover:bg-red-950/20 transition-all text-left"
                                                >
                                                    <div>
                                                        <div className="text-sm font-bold text-white group-hover:text-red-400">{int.name}</div>
                                                        <div className="text-[10px] font-mono text-zinc-500">{int.desc}</div>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-[9px] font-mono text-zinc-400">FEAR +{int.fearBonus}</div>
                                                        <div className="text-[9px] font-mono text-zinc-400">IMPACT: {int.impact}</div>
                                                    </div>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {step === 'RESULT' && intervention && (
                                <div className="h-full flex flex-col items-center justify-center text-center animate-fade-in">
                                    <div className="w-16 h-16 border-2 border-red-500 rounded-full flex items-center justify-center mb-4">
                                        <div className="w-12 h-12 bg-red-500 rounded-full animate-pulse"></div>
                                    </div>
                                    <h3 className="text-xl font-header text-white mb-2">INTERVENTION AUTHORIZED</h3>
                                    <div className="text-sm font-mono text-zinc-300 mb-6 max-w-md">
                                        Protocol <span className="text-red-400">{intervention.name}</span> initiated against {subject.name}. 
                                        {intervention.id === 'ECO' && " Subject's credit rating downgraded. Grants revoked. Bureaucratic nightmare initiated."}
                                        {intervention.id === 'SOC' && " Isolation algorithms active. Peer distancing expected within 48 hours. Communication blackout."}
                                        {intervention.id === 'DET' && " Extraction team dispatched. Cover story: 'Medical Emergency'. Re-education scheduled."}
                                    </div>
                                    <Button onClick={reset}>PROCESS NEXT SUBJECT</Button>
                                </div>
                            )}
                        </Box>
                    </div>
                </div>
            )
        }

        // --- NEW MODULE: SECURE COMMS ---
        const SecureComms = () => {
            const [messages, setMessages] = useState([
                { id: 1, sender: 'MARUS', text: "Director, initial deployment on Hok is complete. However, Kessler's office is blocking our sensor grid installation in the Mining District.", type: 'in' }
            ]);
            const [options, setOptions] = useState([
                { id: 'A', text: "Frame it as a safety audit. Use the recent guild strikes as pretext.", strategy: "SUBTLE" },
                { id: 'B', text: "Override him using Article 4 emergency powers.", strategy: "AGGRESSIVE" }
            ]);
            const [typing, setTyping] = useState(false);

            const handleReply = (option) => {
                setMessages(prev => [...prev, { id: Date.now(), sender: 'KRASK', text: option.text, type: 'out' }]);
                setOptions([]);
                setTyping(true);

                setTimeout(() => {
                    let reply = "";
                    if (option.strategy === "SUBTLE") {
                        reply = "Understood. Framing as 'Infrastructure Safety Audit'. Kessler will have a hard time refusing without appearing negligent given the unrest. Proceeding.";
                    } else {
                        reply = "Risky. Kessler has allies on the Ruling Council. But if you insist... I will attempt to muscle it through. Expect political blowback.";
                    }
                    setMessages(prev => [...prev, { id: Date.now()+1, sender: 'MARUS', text: reply, type: 'in' }]);
                    setTyping(false);
                }, 2000);
            };

            return (
                <div className="h-full flex flex-col animate-slide-in p-4 max-w-4xl mx-auto">
                    <Box title="ENCRYPTED_CHANNEL // MARUS_DIRECT" className="flex-1 mb-4" scroll glowing>
                        <div className="space-y-4">
                            {messages.map(msg => (
                                <div key={msg.id} className={`flex ${msg.type === 'out' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`max-w-[80%] p-3 border ${msg.type === 'out' ? 'bg-zinc-900 border-zinc-700' : 'bg-red-950/20 border-red-900/50'}`}>
                                        <div className="text-[9px] font-mono mb-1 opacity-50">{msg.sender} // {new Date().toLocaleTimeString()}</div>
                                        <div className="text-sm font-mono text-white leading-relaxed">{msg.text}</div>
                                    </div>
                                </div>
                            ))}
                            {typing && (
                                <div className="flex justify-start">
                                    <div className="text-xs font-mono text-zinc-500 animate-pulse">MARUS IS TYPING...</div>
                                </div>
                            )}
                        </div>
                    </Box>
                    <div className="h-32">
                        {options.length > 0 ? (
                            <div className="grid grid-cols-2 gap-4 h-full">
                                {options.map(opt => (
                                    <button 
                                        key={opt.id}
                                        onClick={() => handleReply(opt)}
                                        className="border border-zinc-600 hover:bg-white hover:text-black hover:border-white transition-all p-4 text-left group h-full flex flex-col justify-center"
                                    >
                                        <div className="text-[10px] font-mono uppercase mb-2 text-zinc-500 group-hover:text-zinc-800">Option {opt.id}</div>
                                        <div className="text-sm font-header tracking-wide">{opt.text}</div>
                                    </button>
                                ))}
                            </div>
                        ) : (
                            <div className="h-full border border-zinc-800 flex items-center justify-center text-zinc-600 font-mono text-xs">
                                // AWAITING RESPONSE...
                            </div>
                        )}
                    </div>
                </div>
            )
        }

        // --- INTERACTIVE NETWORK GRAPH ---
        const NetworkAnalysis = () => {
            const [selectedNode, setSelectedNode] = useState(null);
            const [filters, setFilters] = useState({ COMMAND: true, CONFLICT: true, SURV: true });

            // Updated coordinates to ensure they fit in view 100x100
            const nodes = [
                { id: 'KRASK', label: 'DIR. KRASK', x: 50, y: 20, type: 'director', desc: 'Central Authority. ISB Directorate. "The Physician".' },
                { id: 'MARUS', label: 'DIR. MARUS', x: 25, y: 50, type: 'asset', desc: 'Project Panopticon Lead. Pragmatic. Family on Coruscant.' },
                { id: 'KESSLER', label: 'G.M. KESSLER', x: 75, y: 50, type: 'target', desc: 'Political Obstacle. Reformist Leader. Controls Hok.' },
                { id: 'MINING', label: 'GUILD 442', x: 75, y: 80, type: 'target', desc: 'Labor Force. High Unrest. Strike Risk.' },
                { id: 'REBELS', label: 'CELL AUREK', x: 20, y: 85, type: 'threat', desc: 'Insurgency detected. Funding Mining Guild.' },
                { id: 'COMPNOR', label: 'COMPNOR', x: 85, y: 20, type: 'political', desc: 'Political Backing. Budget Source. Ideological Hardliners.' },
                { id: 'UNI', label: 'UNI. HOK', x: 40, y: 70, type: 'surv', desc: 'Academic Dissidents. Monitored.' }
            ];

            const links = [
                { s: 'KRASK', t: 'MARUS', type: 'COMMAND', color: '#fff' },
                { s: 'KRASK', t: 'KESSLER', type: 'CONFLICT', color: '#b91c1c' },
                { s: 'KRASK', t: 'COMPNOR', type: 'COMMAND', color: '#f59e0b' },
                { s: 'KESSLER', t: 'MINING', type: 'COMMAND', color: '#fff' },
                { s: 'REBELS', t: 'MINING', type: 'CONFLICT', color: '#b91c1c' },
                { s: 'MARUS', t: 'MINING', type: 'SURV', color: '#3b82f6' },
                { s: 'MARUS', t: 'UNI', type: 'SURV', color: '#3b82f6' },
                { s: 'REBELS', t: 'UNI', type: 'CONFLICT', color: '#b91c1c' }
            ];

            const toggleFilter = (f) => setFilters(prev => ({ ...prev, [f]: !prev[f] }));

            return (
                <div className="h-full flex gap-6 animate-slide-in">
                    <div className="flex-1 flex flex-col gap-4">
                        <div className="flex gap-2 border-b border-zinc-800 pb-2">
                            <Button active={filters.COMMAND} onClick={() => toggleFilter('COMMAND')}>COMMAND</Button>
                            <Button active={filters.CONFLICT} onClick={() => toggleFilter('CONFLICT')} alert>CONFLICT</Button>
                            <Button active={filters.SURV} onClick={() => toggleFilter('SURV')}>SURVEILLANCE</Button>
                        </div>
                        
                        <Box title="HOLONET_TOPOLOGY // INTERACTIVE" className="flex-1 bg-zinc-950">
                            <svg viewBox="0 0 100 100" className="w-full h-full" preserveAspectRatio="xMidYMid meet">
                                <defs>
                                    <marker id="arrow" markerWidth="4" markerHeight="4" refX="10" refY="2" orient="auto">
                                        <path d="M0,0 L4,2 L0,4" fill="#666" />
                                    </marker>
                                </defs>
                                
                                {links.map((l, i) => {
                                    if (!filters[l.type]) return null;
                                    const s = nodes.find(n => n.id === l.s);
                                    const t = nodes.find(n => n.id === l.t);
                                    const isConnected = selectedNode && (selectedNode.id === l.s || selectedNode.id === l.t);
                                    const opacity = selectedNode ? (isConnected ? 1 : 0.1) : 0.6;
                                    
                                    return (
                                        <g key={i} className="transition-all duration-500">
                                            <line x1={s.x} y1={s.y} x2={t.x} y2={t.y} stroke={l.color} strokeWidth="0.5" opacity={opacity} />
                                            {isConnected && <circle cx={(s.x+t.x)/2} cy={(s.y+t.y)/2} r="1" fill={l.color} className="animate-ping" />}
                                        </g>
                                    )
                                })}

                                {nodes.map((n, i) => {
                                    const isSelected = selectedNode?.id === n.id;
                                    const isDimmed = selectedNode && !isSelected && !links.some(l => filters[l.type] && ((l.s === n.id && l.t === selectedNode.id) || (l.t === n.id && l.s === selectedNode.id)));
                                    
                                    return (
                                        <g 
                                            key={i} 
                                            onClick={() => setSelectedNode(n)}
                                            className={`cursor-pointer transition-all duration-300 ${isDimmed ? 'opacity-20' : 'opacity-100'}`}
                                        >
                                            <circle 
                                                cx={n.x} cy={n.y} r={isSelected ? 6 : 4} 
                                                fill={n.type === 'director' ? '#fff' : n.type === 'target' ? '#b91c1c' : n.type === 'political' ? '#f59e0b' : n.type === 'threat' ? '#ef4444' : '#3b82f6'} 
                                                className="transition-all duration-300"
                                                stroke={isSelected ? 'white' : 'none'}
                                                strokeWidth="0.5"
                                            />
                                            <text x={n.x} y={n.y + 8} fontSize="3" textAnchor="middle" fill={isSelected ? '#fff' : '#888'} className="font-mono font-bold">{n.label}</text>
                                        </g>
                                    )
                                })}
                            </svg>
                        </Box>
                    </div>

                    <div className="w-80 flex flex-col gap-4">
                        <Box title="NODE_INTEL" className="h-2/3" scroll>
                             {selectedNode ? (
                                 <div className="space-y-4 animate-fade-in">
                                    <div className="border-b border-zinc-800 pb-2">
                                        <div className="text-[9px] text-zinc-500 uppercase">Designation</div>
                                        <div className="text-2xl font-header text-white">{selectedNode.label}</div>
                                        <div className="text-xs text-zinc-400 font-mono">{selectedNode.desc}</div>
                                    </div>
                                    
                                    <div className="space-y-2">
                                        <div className="text-[9px] text-zinc-500 uppercase">Connections</div>
                                        {links.filter(l => filters[l.type] && (l.s === selectedNode.id || l.t === selectedNode.id)).map((l, i) => (
                                            <div key={i} className="flex items-center gap-2 text-xs font-mono border border-zinc-800 p-2 bg-zinc-900/50">
                                                <div className="w-2 h-2 rounded-full" style={{background: l.color}}></div>
                                                <span className="text-zinc-400">{l.type}</span>
                                                <span className="text-zinc-600">→</span>
                                                <span className="text-white">{l.s === selectedNode.id ? l.t : l.s}</span>
                                            </div>
                                        ))}
                                    </div>
                                 </div>
                             ) : (
                                 <div className="h-full flex items-center justify-center text-center opacity-50">
                                     <div className="space-y-2">
                                         <div className="text-4xl">☊</div>
                                         <div className="text-xs font-mono">SELECT NODE<br/>FOR ANALYSIS</div>
                                     </div>
                                 </div>
                             )}
                        </Box>
                    </div>
                </div>
            )
        }

        // --- INTERACTIVE LOGISTICS ---
        const Logistics = ({ stability, fear }) => {
            const [budget, setBudget] = useState({ surv: 60, field: 30, rd: 10 });
            const [assets, setAssets] = useState([
                { id: 'P-882', type: 'PROBE', loc: 'Hok Orbit', status: 'SCANNING', health: 100 },
                { id: 'P-883', type: 'PROBE', loc: 'Sector 7G', status: 'OFFLINE', health: 0 },
                { id: 'TRP-A', type: 'TROOPER_BTN', loc: 'Admin Zone', status: 'PATROL', health: 98 },
                { id: 'TRP-B', type: 'TROOPER_BTN', loc: 'Mining Dist', status: 'ENGAGED', health: 75 },
                { id: 'INT-1', type: 'ISB_AGENT', loc: 'Uni. District', status: 'UNDERCOVER', health: 100 }
            ]);
            const [selectedAsset, setSelectedAsset] = useState(null);

            const calcStability = Math.min(100, Math.floor((budget.surv * 0.8) + (budget.field * 0.5) + (stability || 0) * 0.2));
            const calcFear = Math.min(100, Math.floor((budget.field * 1.2) + (budget.surv * 0.2) + (fear || 0) * 0.2));
            
            const handleBudgetChange = (type, val) => {
                const newVal = parseInt(val);
                setBudget(prev => ({ ...prev, [type]: newVal }));
            };

            return (
                <div className="h-full flex gap-6 animate-slide-in">
                    <div className="w-1/2 flex flex-col gap-6">
                        <Box title="RESOURCE_ALLOCATION_MATRIX" className="flex-1">
                            <div className="p-6 space-y-8">
                                <div>
                                    <div className="flex justify-between mb-2 font-header text-xl text-white">
                                        <span>LAYER 1: DATA COLLECTION</span>
                                        <span>{budget.surv}%</span>
                                    </div>
                                    <input type="range" min="0" max="100" value={budget.surv} onChange={(e) => handleBudgetChange('surv', e.target.value)} className="w-full" />
                                    <div className="text-[10px] text-zinc-500 mt-1">Impact: Increases detection. Lowers privacy.</div>
                                </div>

                                <div>
                                    <div className="flex justify-between mb-2 font-header text-xl text-white">
                                        <span>LAYER 2: PREDICTIVE INTERVENTION</span>
                                        <span>{budget.field}%</span>
                                    </div>
                                    <input type="range" min="0" max="100" value={budget.field} onChange={(e) => handleBudgetChange('field', e.target.value)} className="w-full" />
                                    <div className="text-[10px] text-zinc-500 mt-1">Impact: Pre-crime arrests. Generates fear.</div>
                                </div>

                                <div>
                                    <div className="flex justify-between mb-2 font-header text-xl text-white">
                                        <span>LAYER 3: CONDITIONING</span>
                                        <span>{budget.rd}%</span>
                                    </div>
                                    <input type="range" min="0" max="100" value={budget.rd} onChange={(e) => handleBudgetChange('rd', e.target.value)} className="w-full" />
                                    <div className="text-[10px] text-zinc-500 mt-1">Impact: Long term stability. Cultural alignment.</div>
                                </div>
                                
                                <div className="pt-4 border-t border-zinc-800 grid grid-cols-2 gap-4">
                                    <div className="p-2 border border-zinc-800 bg-zinc-900 text-center"><div className="text-[9px] text-zinc-500">NET STABILITY</div><div className="text-xl text-white font-header">{calcStability}%</div></div>
                                    <div className="p-2 border border-zinc-800 bg-zinc-900 text-center"><div className="text-[9px] text-zinc-500">NET FEAR</div><div className="text-xl text-red-500 font-header">{calcFear}%</div></div>
                                </div>
                            </div>
                        </Box>
                    </div>

                    <div className="w-1/2 flex flex-col gap-6">
                        <Box title="ASSET_MANIFEST" className="h-2/3" scroll>
                            <div className="space-y-2">
                                {assets.map(asset => (
                                    <div key={asset.id} onClick={() => setSelectedAsset(asset)} className={`p-3 border cursor-pointer transition-all flex justify-between items-center ${selectedAsset?.id === asset.id ? 'bg-zinc-800 border-white' : 'bg-black border-zinc-800 hover:bg-zinc-900'}`}>
                                        <div><div className="font-tech text-white">{asset.id}</div><div className="text-[9px] text-zinc-500">{asset.type}</div></div>
                                        <div className="text-right"><div className={`text-[10px] font-bold ${asset.status === 'OFFLINE' || asset.status === 'ENGAGED' ? 'text-red-500' : 'text-green-500'}`}>{asset.status}</div><div className="text-[9px] text-zinc-500">{asset.loc}</div></div>
                                    </div>
                                ))}
                            </div>
                        </Box>
                        <Box title="UNIT_DETAILS" className="h-1/3" alert={selectedAsset?.health < 50}>
                            {selectedAsset ? (
                                <div className="space-y-2 animate-fade-in">
                                    <div className="flex justify-between items-center"><span className="font-header text-xl text-white">{selectedAsset.id}</span><span className="text-xs font-mono">{selectedAsset.type}</span></div>
                                    <div className="space-y-1"><div className="flex justify-between text-[9px] text-zinc-500"><span>INTEGRITY</span><span>{selectedAsset.health}%</span></div><LoadingBar progress={selectedAsset.health} color={selectedAsset.health < 30 ? 'bg-red-600' : 'bg-white'} /></div>
                                    <div className="grid grid-cols-2 gap-2 mt-2"><Button>RECALL</Button><Button alert>SELF_DESTRUCT</Button></div>
                                </div>
                            ) : (<div className="h-full flex items-center justify-center text-center opacity-50 text-xs font-mono">SELECT UNIT</div>)}
                        </Box>
                    </div>
                </div>
            )
        }

        // --- TACTICAL MAP (HOK) ---
        const InteractiveMap = () => {
            const [selectedSector, setSelectedSector] = useState(null);
            const [overlay, setOverlay] = useState('RISK');
            const [tab, setTab] = useState('MAP');

            const handleSectorClick = (sector) => {
                setSelectedSector(sector);
                setTab('DATA');
            };

            const getSectorColor = (sector) => {
                if (overlay === 'RISK') return sector.risk > 70 ? '#ef4444' : sector.risk > 40 ? '#f59e0b' : '#10b981';
                if (overlay === 'OUTPUT') return sector.output < 50 ? '#ef4444' : '#10b981';
                if (overlay === 'SURV') return '#3b82f6';
                return '#fff';
            };

            return (
                <div className="h-full flex flex-col gap-4 animate-slide-in">
                    <div className="flex gap-2 border-b border-zinc-800 pb-2 shrink-0">
                        <Button active={tab === 'MAP'} onClick={() => setTab('MAP')}>SECTOR_MAP</Button>
                        <Button active={tab === 'DATA'} onClick={() => setTab('DATA')}>SECTOR_INTEL</Button>
                        <Button active={tab === 'LABOR'} onClick={() => setTab('LABOR')} alert>LABOR_WATCH</Button>
                    </div>

                    <div className="flex-1 flex gap-4 min-h-0">
                        <Box title={`TACTICAL_VIEW // HOK // ${overlay}_OVERLAY`} className="flex-1 bg-zinc-950">
                            <div className="absolute top-4 left-4 z-10 flex gap-2">
                                <Button active={overlay === 'RISK'} onClick={() => setOverlay('RISK')} alert>RISK</Button>
                                <Button active={overlay === 'OUTPUT'} onClick={() => setOverlay('OUTPUT')}>OUTPUT</Button>
                                <Button active={overlay === 'SURV'} onClick={() => setOverlay('SURV')}>SURVEILLANCE</Button>
                            </div>

                            <div className="w-full h-full relative p-8">
                                <svg viewBox="0 0 100 100" className="w-full h-full filter drop-shadow-[0_0_10px_rgba(0,0,0,0.5)]">
                                    <defs>
                                        <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
                                            <path d="M 10 0 L 0 0 0 10" fill="none" stroke="#222" strokeWidth="0.5"/>
                                        </pattern>
                                    </defs>
                                    <rect width="100%" height="100%" fill="url(#grid)" />
                                    <path d="M20,30 L45,50 L70,30 L60,70 L30,60 Z" fill="none" stroke="#333" strokeWidth="0.5" strokeDasharray="2 2" />
                                    {SECTORS.map((sector) => {
                                        const isSelected = selectedSector?.id === sector.id;
                                        const color = getSectorColor(sector);
                                        return (
                                            <g key={sector.id} onClick={() => handleSectorClick(sector)} className="cursor-pointer transition-all duration-300 group">
                                                {isSelected && <circle cx={sector.x} cy={sector.y} r="12" fill="none" stroke="white" strokeWidth="0.5" className="animate-ping opacity-50" />}
                                                <circle cx={sector.x} cy={sector.y} r={isSelected ? 6 : 4} fill={color} fillOpacity="0.2" stroke={color} strokeWidth={isSelected ? 1 : 0.5} className="transition-all duration-300" />
                                                <text x={sector.x} y={sector.y + 10} fill={isSelected ? '#fff' : '#666'} fontSize="3" textAnchor="middle" className="font-mono tracking-widest uppercase transition-colors">{sector.name}</text>
                                                <rect x={sector.x + 5} y={sector.y - 5} width="20" height="8" fill="#111" stroke="#333" strokeWidth="0.2" className="opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none" />
                                                <text x={sector.x + 7} y={sector.y} fill="#aaa" fontSize="2" className="font-mono opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">RISK: {sector.risk}%</text>
                                            </g>
                                        );
                                    })}
                                </svg>
                            </div>
                        </Box>

                        <div className="w-80 flex flex-col gap-4">
                            {tab === 'LABOR' ? (
                                <Box title="GUILD_442_SURVEILLANCE" className="h-full" alert scroll>
                                    <div className="space-y-4">
                                        <div className="p-2 bg-red-950/20 border border-red-900/50 text-red-400 text-xs font-mono">WARNING: ILLEGAL ASSEMBLY DETECTED IN SECTOR 7G</div>
                                        <div className="space-y-2 text-[10px] font-mono text-zinc-400 border-l border-zinc-800 pl-2">
                                            <p><span className="text-zinc-600">TARGET_A:</span> "We can't meet the new quotas. It's physically impossible."</p>
                                            <p><span className="text-zinc-600">TARGET_B:</span> "Kalen says we strike tomorrow. Before the new shift."</p>
                                        </div>
                                        <Button alert className="w-full mt-2">FLAG FOR INTERVENTION</Button>
                                    </div>
                                </Box>
                            ) : (
                                <Box title="SECTOR_INTEL" className="h-full" scroll>
                                    {selectedSector ? (
                                        <div className="space-y-4 animate-fade-in">
                                            <div><h2 className="text-xl font-header text-white mb-1">{selectedSector.name}</h2><div className="text-[9px] font-mono text-zinc-500">{selectedSector.id} // SECURE_GRID_4</div></div>
                                            <div className="p-2 border border-zinc-800 bg-zinc-900/50"><div className="text-[9px] font-mono text-zinc-500 uppercase mb-1">Status Report</div><p className="text-xs font-tech text-white leading-tight">{selectedSector.detail}</p></div>
                                            <div className="space-y-3">
                                                <div><div className="flex justify-between text-[9px] font-mono text-zinc-500 mb-1"><span>INSURGENCY RISK</span><span className={selectedSector.risk > 50 ? 'text-red-500' : 'text-zinc-400'}>{selectedSector.risk}%</span></div><LoadingBar progress={selectedSector.risk} color={selectedSector.risk > 50 ? 'bg-red-600' : 'bg-green-600'} /></div>
                                            </div>
                                        </div>
                                    ) : (<div className="h-full flex items-center justify-center text-center opacity-50"><div className="space-y-2"><div className="text-4xl">⌖</div><div className="text-xs font-mono">SELECT SECTOR<br/>FOR ANALYSIS</div></div></div>)}
                                </Box>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- ENCRYPTION MODULE ---
        const Encryption = () => {
            const [input, setInput] = useState('');
            const [key, setKey] = useState('');
            const [output, setOutput] = useState('');
            const [mode, setMode] = useState('ENCRYPT'); 
            const [isProcessing, setIsProcessing] = useState(false);

            const handleProcess = () => {
                if (!key || !input) { setOutput("ERROR: MISSING_INPUT_OR_KEY"); return; }
                setIsProcessing(true); setOutput('');
                setTimeout(() => {
                    let result = "";
                    const cleanInput = input.toUpperCase();
                    const cleanKey = key.toUpperCase().replace(/[^A-Z0-9]/g, '');
                    if (!cleanKey) { setOutput("ERROR: INVALID_KEY_FORMAT"); setIsProcessing(false); return; }
                    for (let i = 0, j = 0; i < cleanInput.length; i++) {
                        const char = cleanInput.charCodeAt(i);
                        if (char >= 65 && char <= 90) {
                            const keyChar = cleanKey.charCodeAt(j % cleanKey.length);
                            const shift = keyChar - 65;
                            if (mode === 'ENCRYPT') { result += String.fromCharCode(((char - 65 + shift) % 26) + 65); } 
                            else { result += String.fromCharCode(((char - 65 - shift + 26) % 26) + 65); }
                            j++;
                        } else { result += cleanInput[i]; }
                    }
                    setOutput(result); setIsProcessing(false);
                }, 800);
            };

            return (
                <div className="h-full flex items-center justify-center p-8">
                    <Box title="SIGINT // CRYPTO_SUITE_V2" className="w-full max-w-4xl h-full" glowing>
                        <div className="flex flex-col h-full gap-6">
                            <div className="flex justify-between items-center border-b border-zinc-800 pb-4">
                                <div className="flex gap-4">
                                    <Button active={mode === 'ENCRYPT'} onClick={() => setMode('ENCRYPT')}>ENCRYPT_MODE</Button>
                                    <Button active={mode === 'DECRYPT'} onClick={() => setMode('DECRYPT')} alert>DECRYPT_MODE</Button>
                                </div>
                                <div className="w-64">
                                    <div className="text-[9px] font-mono text-zinc-500 uppercase mb-1">Encryption Key (Mandatory)</div>
                                    <input type="text" value={key} onChange={(e) => setKey(e.target.value.toUpperCase())} className="w-full bg-zinc-900 border border-zinc-700 p-1 text-sm font-mono text-red-500 focus:outline-none focus:border-red-500 tracking-widest text-center" placeholder="ENTER_KEY_SEQUENCE" />
                                </div>
                            </div>
                            <div className="flex-1 grid grid-cols-2 gap-6 min-h-0">
                                <div className="flex flex-col gap-2">
                                    <label className="text-[10px] font-mono text-zinc-500 uppercase">Input Data</label>
                                    <textarea className="flex-1 bg-black border border-zinc-700 p-4 font-mono text-zinc-300 text-sm focus:border-white focus:outline-none resize-none placeholder-zinc-800" placeholder={mode === 'ENCRYPT' ? "ENTER CLEAR TEXT..." : "ENTER ENCRYPTED DATA..."} value={input} onChange={(e) => setInput(e.target.value)} spellCheck="false"></textarea>
                                </div>
                                <div className="flex flex-col gap-2">
                                    <label className="text-[10px] font-mono text-zinc-500 uppercase">Result Data</label>
                                    <div className="flex-1 bg-zinc-900/50 border border-zinc-800 p-4 font-mono text-sm relative overflow-y-auto custom-scroll">
                                        {isProcessing ? (<div className="absolute inset-0 flex items-center justify-center flex-col gap-4"><div className="w-12 h-12 border-t-2 border-r-2 border-white rounded-full animate-spin"></div><div className="text-[10px] text-zinc-500 animate-pulse tracking-widest">PROCESSING ALGORITHM...</div></div>) : (<div className="text-white break-all whitespace-pre-wrap tracking-wide">{output}</div>)}
                                    </div>
                                </div>
                            </div>
                            <div className="pt-2 flex justify-center">
                                <button onClick={handleProcess} disabled={isProcessing || !key} className={`px-12 py-3 text-sm font-header tracking-[0.3em] uppercase transition-all ${isProcessing || !key ? 'bg-zinc-900 text-zinc-600 border border-zinc-800 cursor-not-allowed' : 'bg-white text-black hover:bg-zinc-200 border border-white shadow-[0_0_20px_rgba(255,255,255,0.2)]'}`}>{isProcessing ? 'CALCULATING' : 'EXECUTE'}</button>
                            </div>
                        </div>
                    </Box>
                </div>
            );
        };

        // --- DASHBOARD (Main) ---
        const Dashboard = ({ stability, fear }) => {
             const resources = [{ label: "Data Coll.", val: 85 }, { label: "Predictive", val: 45 }, { label: "Conditioning", val: 60 }, { label: "Detention", val: 30 }];
             const trendData = [40, 45, 42, 50, 55, 52, 60, 65, 62, 70];
             
             return (
                <div className="h-full grid grid-cols-12 grid-rows-6 gap-4 animate-fade-in">
                    <Box title="SYSTEM_METRICS" className="col-span-8 row-span-2">
                        <div className="grid grid-cols-4 gap-4 h-full content-center">
                            <div className="text-center p-2 border border-zinc-800 bg-zinc-950/50"><div className="text-3xl font-header text-white mb-1">{stability}%</div><div className="text-[9px] font-mono text-zinc-500 uppercase">Stability Index</div></div>
                            <div className="text-center p-2 border border-zinc-800 bg-zinc-950/50"><div className="text-3xl font-header text-red-500 mb-1 animate-pulse">12</div><div className="text-[9px] font-mono text-zinc-500 uppercase">Active Alerts</div></div>
                            <div className="text-center p-2 border border-zinc-800 bg-zinc-950/50"><div className="text-3xl font-header text-white mb-1">94%</div><div className="text-[9px] font-mono text-zinc-500 uppercase">Resource Output</div></div>
                            <div className="text-center p-2 border border-zinc-800 bg-zinc-950/50"><div className="text-3xl font-header text-amber-500 mb-1">{fear}%</div><div className="text-[9px] font-mono text-zinc-500 uppercase">Fear Index</div></div>
                        </div>
                    </Box>
                    <Box title="PRIORITY_FEED" className="col-span-4 row-span-6" alert scroll>
                         <div className="space-y-3">
                            {[{ src: "HOK", msg: "Labor strikes reported in Sector 7G. Guild 442.", time: "00:02" }, { src: "CORUSCANT", msg: "Budget for Phase II approved by COMPNOR.", time: "01:15" }, { src: "KESSEL", msg: "Insurgency activity spike.", time: "02:30" }, { src: "SYS", msg: "Director Marus login detected.", time: "03:45" }, { src: "INTEL", msg: "Grand Moff Kessler viewing Mining Reports.", time: "04:10" }].map((item, i) => (
                                <div key={i} className="pb-2 border-b border-zinc-800/50"><div className="flex justify-between text-[9px] font-mono text-zinc-500 mb-1"><span>{item.src}</span><span>-{item.time}</span></div><div className="text-xs font-tech text-zinc-300 leading-tight">{item.msg}</div></div>
                            ))}
                        </div>
                    </Box>
                    <Box title="STABILITY_TREND" className="col-span-5 row-span-4 bg-zinc-900">
                        <div className="w-full h-full relative p-4 flex flex-col">
                            <div className="flex-1 relative">
                                <LineChart data={trendData} color="#ef4444" />
                            </div>
                        </div>
                    </Box>
                    <Box title="INITIATIVE_STATUS" className="col-span-3 row-span-4"><div className="h-full flex flex-col justify-around px-2">{resources.map((r, i) => (<div key={i} className="space-y-1"><div className="flex justify-between text-[9px] font-mono text-zinc-400"><span>{r.label}</span><span>{r.val}%</span></div><LoadingBar progress={r.val} color="bg-zinc-600" /></div>))}</div></Box>
                </div>
            );
        };

        // --- PANOPTICON (Detailed) ---
        const Panopticon = ({ stability, fear, unlocked }) => {
             const [expanded, setExpanded] = useState('I');
             const [tab, setTab] = useState('PHASES');
             const [sim, setSim] = useState({ name: 'Subject 8821', risk: 12 });

             useEffect(() => {
                 if(tab !== 'ALGO') return;
                 const interval = setInterval(() => { setSim({ name: `Subject ${Math.floor(Math.random()*9000)+1000}`, risk: Math.floor(Math.random() * 100) }); }, 2000);
                 return () => clearInterval(interval);
             }, [tab]);

             const phases = [
                { id: "I", title: "FOUNDATION (Data)", detail: "Comprehensive data collection. Integration of medical, financial, and transit records.", tasks: ["Recruit Local Personnel", "Inventory Assets", "Audit Civil Service", "Secure Kessler Authorization"] },
                { id: "II", title: "PREDICTIVE (Analysis)", locked: !unlocked, detail: "Algorithm v4 deployment. Identifying risk patterns before crimes occur.", tasks: ["Deploy Camera Grid", "Install Bio-Scanners", "Activate Algorithm v4", "Establish Ops Center"] },
                { id: "III", title: "INTERVENTION (Conditioning)", locked: !unlocked, detail: "Graduated pressure protocols. Making resistance psychologically impossible.", tasks: ["Identify High-Risk Targets", "Begin Graduated Pressure", "Monitor Dissident Response", "Test Intervention Thresholds"] }
            ];

            return (
                <div className="h-full flex flex-col gap-6 animate-slide-in">
                    <Box title="PROJECT_HEADER" className="shrink-0 p-6 flex justify-between items-center">
                        <div><h1 className="text-4xl font-header text-white mb-2">COMPREHENSIVE SOCIAL EQUILIBRIUM</h1><p className="font-mono text-sm text-zinc-400 max-w-3xl">"Privacy allows conspiracy. Privacy enables resistance. Privacy creates blind spots."</p></div>
                        <div className="text-right flex flex-col gap-2"><div className="text-xs font-mono text-zinc-500">TARGET: HOK (OVERSECTOR 4)</div><div className="flex gap-2 justify-end"><Button active={tab === 'PHASES'} onClick={() => setTab('PHASES')}>PHASE_VIEW</Button><Button active={tab === 'ALGO'} onClick={() => setTab('ALGO')} alert>PREDICTIVE_MODEL</Button></div></div>
                    </Box>

                    <div className="flex-1 min-h-0 flex gap-6">
                        {tab === 'PHASES' && (
                            <>
                            <Box title="PHASE_EXECUTOR" className="w-1/3" scroll>
                                <div className="space-y-4">
                                    {phases.map((p) => (
                                        <div key={p.id} className={`border ${p.locked ? 'border-zinc-900 opacity-50' : 'border-zinc-800 bg-zinc-900/30'}`}>
                                            <button onClick={() => !p.locked && setExpanded(expanded === p.id ? null : p.id)} className="w-full p-4 flex justify-between items-center hover:bg-zinc-800 transition-colors">
                                                <span className="font-header text-lg text-white">PHASE {p.id} // {p.title} {p.locked && '[LOCKED]'}</span>
                                                <span className="text-xs font-mono text-zinc-500">{p.locked ? '🔒' : (expanded === p.id ? '[-]' : '[+]')}</span>
                                            </button>
                                            {expanded === p.id && !p.locked && (
                                                <div className="p-4 border-t border-zinc-800 bg-zinc-950/50">
                                                    <p className="text-xs font-mono text-zinc-400 mb-4">{p.detail}</p>
                                                    <div className="space-y-2">{p.tasks.map((t, i) => (<div key={i} className="flex items-center gap-3 text-xs font-mono text-zinc-500"><div className="w-3 h-3 border border-zinc-600"></div>{t}</div>))}</div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </Box>
                            <div className="w-1/3 flex flex-col gap-4">
                                <Box title="PSYCHOGRAPHIC_MODEL" className="h-1/2">
                                    <RadarChart stability={stability} fear={fear} />
                                </Box>
                                <Box title="FALSE_POSITIVE_UTILITY" className="h-1/2 p-4">
                                    <div className="text-xs font-mono text-zinc-400 mb-2">"False positives are a feature, not a bug. Generalized uncertainty creates caution." - THE PHYSICIAN</div>
                                    <div className="mt-4"><div className="flex justify-between text-[10px] text-zinc-500 uppercase"><span>Current Error Rate</span><span className="text-white">12%</span></div><LoadingBar progress={12} color="bg-red-600" /></div>
                                </Box>
                            </div>
                            </>
                        )}
                        {tab === 'ALGO' && (
                             <Box title="ALGORITHMIC_PROCESSING_UNIT" className="w-2/3" glowing>
                                 <div className="h-full flex flex-col items-center justify-center"><div className="w-64 h-64 border-4 border-zinc-800 rounded-full flex items-center justify-center relative"><div className="absolute inset-0 border-2 border-red-900 rounded-full animate-ping opacity-20"></div><div className="text-center"><div className="text-xs font-mono text-zinc-500">ANALYZING</div><div className="text-2xl font-header text-white">{sim.name}</div><div className="text-4xl font-header mt-2" style={{color: sim.risk > 80 ? 'red' : sim.risk > 50 ? 'orange' : 'green'}}>{sim.risk}%</div><div className="text-[10px] font-mono text-zinc-500 mt-1">RISK QUOTIENT</div></div></div></div>
                             </Box>
                        )}
                        <div className="w-1/3 flex flex-col gap-6">
                            <Box title="POLITICAL_OBSTACLE" alert fit>
                                <div className="p-4"><div className="flex items-center gap-4 mb-4"><div className="w-12 h-12 bg-zinc-900 border border-red-900 flex items-center justify-center text-red-700 font-header text-xl">GK</div><div><div className="text-sm font-bold text-white uppercase">Grand Moff Kessler</div><div className="text-[10px] text-zinc-500">Reformist Faction Leader</div></div></div><p className="text-xs text-zinc-400 font-mono leading-tight">Advocates "Trust-Based Governance". Blocking expansion in Oversector 4. Vulnerable to accusations of negligence regarding Mining Guild strikes.</p></div>
                            </Box>
                        </div>
                    </div>
                </div>
            );
        }

        const Dossiers = () => {
             const [selected, setSelected] = useState('krask');
             const profiles = { 
                 krask: { name: "VALEN KRASK", rank: "DIRECTOR", unit: "ISB CENTRAL", bio: `Born 50 BBY, Alsakan. Nicknames: "The Physician", "The Surgeon". Approaches security as surgery. Believes the Republic failed because it couldn't make difficult decisions. Unmarried. No children. "The Ivory Tower" is his only home. Quote: "Order is mercy. Chaos is cruelty."`, activity: ["Authorized Phase II Budget", "Meeting with T. Marus (0700)", "Reviewed 'Death Star' failure memo"] }, 
                 marus: { name: "THANE MARUS", rank: "PROJECT DIRECTOR", unit: "PANOPTICON INITIATIVE", bio: `Deputy Director. Intelligent, pragmatic. Selected for flexibility. Questioned ethical implications: "Have we built a society or a prison?" Family: Wife + 2 Children (Coruscant). Hesitant but loyal. Accepted promotion to Director Grade 3.`, activity: ["Accepted Hok Assignment", "Briefing with Tech Division", "Relocation Protocols Initiated"] }, 
                 kessler: { name: "GARRIK KESSLER", rank: "GRAND MOFF", unit: "OVERSECTOR 4", bio: `Primary political obstacle. Reformist Leader. Advocates "Trust-Based Governance". Believes heavy security creates resistance. Controls Hok.`, activity: ["Submitted complaint re: ISB overreach", "Touring Mining District 7G", "Denied automated surveillance permit"] } 
            };
            const data = profiles[selected];
            return (
                <div className="h-full flex gap-6 animate-slide-in">
                    <div className="w-64 flex flex-col gap-2">{Object.entries(profiles).map(([key, p]) => (<button key={key} onClick={() => setSelected(key)} className={`p-4 border text-left transition-all ${selected === key ? 'bg-zinc-900 border-white' : 'bg-black border-zinc-800 hover:border-zinc-600'}`}><div className="text-[9px] font-mono text-zinc-500 uppercase">{p.rank}</div><div className="font-header text-lg text-white">{p.name}</div></button>))}</div>
                    <Box title={`SUBJECT // ${data.name}`} className="flex-1" scroll><div className="grid grid-cols-2 gap-8"><div><div className="mb-6"><div className="text-[9px] font-mono text-zinc-500 uppercase mb-2">Biographical Summary</div><p className="font-mono text-sm text-zinc-300 leading-relaxed whitespace-pre-line">{data.bio}</p></div></div><div><div className="text-[9px] font-mono text-zinc-500 uppercase mb-2 border-b border-zinc-800 pb-1">Recent Activity Log</div><div className="space-y-2">{data.activity.map((act, i) => (<div key={i} className="flex gap-3 text-xs font-mono text-zinc-400"><span className="text-zinc-600">[-0{i}h]</span><span>{act}</span></div>))}</div></div></div></Box>
                </div>
            );
        };

        const Archives = () => {
            const logs = [
                { id: "LOG-0547", date: "5 ABY // 05:47", title: "THE PHYSICIAN'S LOG", text: "The city transitions from night to day. Awareness gives me satisfaction. Not pleasure. Satisfaction. The systems work. My office is bare. Decoration implies leisure. I have no time for leisure. Order requires vigilance. The Ivory Tower stands as a monument to that vigilance." },
                { id: "LOG-0700", date: "5 ABY // 07:00", title: "Meeting: Marus / Panopticon", text: "Marus is skeptical but obedient. I showed him the 'Comprehensive Social Equilibrium Initiative'. He asked if we are building a society or a prison. I told him: 'Freedom isn't the absence of structure, it's the presence of safe structure.' We are building systematic inevitability." },
                { id: "LOG-21BBY", date: "21 BBY // ARCHIVE", title: "Refugee Crisis Management", text: "Refugee populations are security vulnerabilities. Compassion that compromises security is not compassion, it's negligence. I would rather detain a thousand innocent people than let one saboteur through." },
                { id: "LOG-04ABY", date: "4 ABY // POST-ENDOR", title: "The Crisis of Authority", text: "The Emperor is dead. The mechanism is broken. Without him, we have institutions, yes, but we lack the unifying force. We must create different capabilities. Institutional rather than personal. We must become the consequence that prevents fragmentation." }
            ];
            return (
                <div className="h-full flex gap-6 animate-slide-in">
                    <Box title="LOG_INDEX" className="w-1/3" scroll><div className="space-y-2">{logs.map((log) => (<div key={log.id} className="p-3 border border-zinc-800 hover:bg-zinc-900 hover:border-zinc-600 transition-all cursor-pointer group"><div className="flex justify-between items-center mb-1"><span className="text-[10px] font-mono text-red-500">{log.id}</span><span className="text-[9px] text-zinc-600">{log.date.split('//')[0]}</span></div><div className="text-sm font-tech text-zinc-300 group-hover:text-white">{log.title}</div></div>))}</div></Box>
                    <Box title="CONTENT_VIEWER" className="flex-1" scroll><div className="space-y-8 pr-4">{logs.map((log) => (<div key={log.id} className="pb-8 border-b border-zinc-800 last:border-0"><div className="flex items-center gap-4 mb-4"><div className="px-2 py-1 bg-zinc-900 border border-zinc-700 text-[10px] font-mono text-zinc-400">{log.id}</div><div className="text-xs font-mono text-zinc-500 uppercase">{log.date}</div></div><h3 className="text-lg font-header text-white mb-2 uppercase tracking-wide">{log.title}</h3><p className="font-mono text-sm text-zinc-300 leading-relaxed whitespace-pre-wrap">{log.text}</p></div>))}</div></Box>
                </div>
            );
        };

        // ==========================================
        // APP SHELL
        // ==========================================

        const App = () => {
            const [view, setView] = useState('dashboard');
            const [loginStep, setLoginStep] = useState(0);
            const [alertLevel, setAlertLevel] = useState('LOW');
            const [stability, setStability] = useState(89);
            const [fear, setFear] = useState(24);
            const [unlockedPhases, setUnlockedPhases] = useState(false);

            const handleLogin = () => {
                if (loginStep === 0) { setLoginStep(1); setTimeout(() => setLoginStep(2), 1500); setTimeout(() => setLoginStep(3), 3000); }
            };

            const toggleAlert = () => {
                setAlertLevel(prev => prev === 'LOW' ? 'HIGH' : 'LOW');
            };

            const handleIntervention = (fBonus, sBonus) => {
                setFear(prev => Math.min(100, prev + fBonus));
                setStability(prev => Math.min(100, prev + sBonus));
            };

            // Terminal Command Handler (State Uplift)
            const handleTerminalCommand = (action) => {
                if (action.type === 'ALERT') setAlertLevel(action.payload);
                if (action.type === 'NAVIGATE') setView(action.payload);
                if (action.type === 'UNLOCK') setUnlockedPhases(true);
                if (action.type === 'FEAR_SPIKE') setFear(prev => Math.min(100, prev + action.payload));
            };

            if (loginStep < 3) {
                return (
                    <div className="h-screen w-screen bg-black flex items-center justify-center relative overflow-hidden cursor-pointer" onClick={handleLogin}>
                         <div className="crt-overlay"></div><div className="scanline"></div>
                         <div className="relative z-20 text-center flex flex-col items-center gap-6">
                            <div className="border-4 border-white p-2 mb-4"><div className="border border-white p-8"><h1 className="text-8xl font-header text-white tracking-[0.2em] text-glow">ISB</h1></div></div>
                            <div className="h-12 flex items-center justify-center w-64">
                                {loginStep === 0 && <div className="animate-pulse text-sm font-mono text-zinc-500 tracking-widest cursor-blink">[ INSERT CYLINDER ]</div>}
                                {loginStep === 1 && <div className="text-red-500 font-mono text-xs tracking-widest">READING BIOMETRICS...</div>}
                                {loginStep === 2 && (<div className="w-full"><div className="text-xs font-mono text-zinc-400 mb-2 text-left">DECRYPTING KEY...</div><LoadingBar progress={100} color="bg-white" height="h-2" animated /></div>)}
                            </div>
                         </div>
                         <div className="absolute inset-0 bg-grid-pattern opacity-10"></div>
                    </div>
                );
            }

            const NAV = [
                { id: 'dashboard', label: 'CMD_DECK', icon: 'GRID' },
                { id: 'panopticon', label: 'PRJ_PANOPTICON', icon: 'EYE' },
                { id: 'analytics', label: 'ANALYTICS', icon: 'BAR' }, // NEW
                { id: 'surveillance', label: 'SURVEILLANCE', icon: 'CAM' }, // NEW
                { id: 'hok', label: 'SEC_VIEW_HOK', icon: 'MAP' },
                { id: 'psych', label: 'PSYCH_EVAL', icon: 'MED' },
                { id: 'comms', label: 'SECURE_COMMS', icon: 'MSG' },
                { id: 'terminal', label: 'TERMINAL', icon: 'CMD' }, // NEW
                { id: 'logistics', label: 'LOGISTICS', icon: 'BOX' },
                { id: 'network', label: 'NETWORK_GRPH', icon: 'NET' },
                { id: 'dossiers', label: 'DOSSIERS', icon: 'USER' },
                { id: 'encryption', label: 'ENCRYPTION', icon: 'LOCK' },
                { id: 'archives', label: 'ARCHIVES', icon: 'FILE' }
            ];

            return (
                <div className={`h-screen w-screen bg-black text-white flex flex-col overflow-hidden relative selection:bg-red-900 selection:text-white transition-colors duration-1000 ${alertLevel === 'HIGH' ? 'shadow-[inset_0_0_100px_rgba(185,28,28,0.2)]' : ''}`}>
                    <div className="crt-overlay"></div><div className="scanline"></div><div className="absolute inset-0 bg-grid-pattern opacity-10 pointer-events-none"></div>
                    
                    <header className="h-16 shrink-0 border-b border-zinc-800 bg-zinc-950 flex items-center justify-between px-6 relative z-30">
                        <div className="flex items-center gap-4">
                            <div className={`w-8 h-8 border border-white flex items-center justify-center font-header text-xl ${alertLevel === 'HIGH' ? 'bg-red-600 text-black animate-pulse' : 'bg-white text-black'}`}>ISB</div>
                            <div><h1 className="text-xl font-header tracking-widest text-white leading-none">{LORE.director}</h1><div className="text-[9px] font-mono text-zinc-500 tracking-[0.2em]">{LORE.id} // {LORE.clearance}</div></div>
                        </div>
                        
                        <div className="flex items-center gap-4">
                            <button onClick={toggleAlert} className={`border px-3 py-1 text-[10px] font-mono tracking-widest transition-all ${alertLevel === 'HIGH' ? 'border-red-500 text-red-500 bg-red-950/20' : 'border-zinc-800 text-zinc-600 hover:text-white'}`}>
                                DEFCON: {alertLevel}
                            </button>
                            <div className="hidden lg:block text-[10px] font-mono text-zinc-600 tracking-[0.3em] opacity-50">"{LORE.motto}"</div>
                        </div>

                        <div className="flex items-center gap-8">
                            <div className="hidden md:block text-right">
                                <div className={`text-[10px] font-mono tracking-widest ${alertLevel === 'HIGH' ? 'text-red-500 animate-pulse' : 'text-green-500'}`}>
                                    {alertLevel === 'HIGH' ? 'LOCKDOWN PROTOCOL' : 'SECURE UPLINK ACTIVE'}
                                </div>
                                <div className="text-[9px] font-mono text-zinc-600">{LORE.location}</div>
                            </div>
                            <div className="text-right"><div className="text-xl font-mono-bold text-white leading-none">0547</div><div className="text-[10px] font-mono text-zinc-500">CYCLE 144</div></div>
                        </div>
                    </header>
                    
                    <div className="flex-1 flex overflow-hidden relative z-20">
                        <nav className="w-16 md:w-64 shrink-0 bg-zinc-950 border-r border-zinc-800 flex flex-col custom-scroll overflow-y-auto">
                            <div className="flex-1 py-6 flex flex-col gap-1">
                                {NAV.map((item) => (
                                    <button key={item.id} onClick={() => setView(item.id)} className={`group relative px-6 py-3 text-left transition-all duration-200 flex items-center gap-4 hover:bg-zinc-900 ${view === item.id ? 'border-r-2 border-white bg-zinc-900' : 'border-r-2 border-transparent'}`}>
                                        <div className={`text-lg transition-colors ${view === item.id ? 'text-red-500' : 'text-zinc-600 group-hover:text-zinc-400'}`}>
                                            {item.icon === 'GRID' && '⊞'} {item.icon === 'EYE' && '◉'} {item.icon === 'MAP' && '⌖'} {item.icon === 'USER' && '♟'} {item.icon === 'LOCK' && '⚿'} {item.icon === 'FILE' && '≡'} {item.icon === 'BOX' && '◫'} {item.icon === 'NET' && '☊'} {item.icon === 'MED' && '⚕'} {item.icon === 'MSG' && '✉'} {item.icon === 'CMD' && '⏾'} {item.icon === 'CAM' && '◎'} {item.icon === 'BAR' && '📶'}
                                        </div>
                                        <span className={`hidden md:block text-xs font-tech tracking-wider uppercase ${view === item.id ? 'text-white' : 'text-zinc-500 group-hover:text-zinc-300'}`}>{item.label}</span>
                                    </button>
                                ))}
                            </div>
                        </nav>
                        <main className="flex-1 bg-black p-6 md:p-8 overflow-hidden flex flex-col relative">
                            <div className="flex-1 min-h-0 relative">
                                {view === 'dashboard' && <Dashboard stability={stability} fear={fear} />}
                                {view === 'panopticon' && <Panopticon stability={stability} fear={fear} unlocked={unlockedPhases} />}
                                {view === 'analytics' && <Analytics />}
                                {view === 'surveillance' && <Surveillance />}
                                {view === 'terminal' && <Terminal onCommand={handleTerminalCommand} />}
                                {view === 'hok' && <InteractiveMap />}
                                {view === 'encryption' && <Encryption />}
                                {view === 'archives' && <Archives />}
                                {view === 'dossiers' && <Dossiers />}
                                {view === 'network' && <NetworkAnalysis />}
                                {view === 'logistics' && <Logistics stability={stability} fear={fear} />}
                                {view === 'psych' && <BehavioralMod onIntervention={handleIntervention} />}
                                {view === 'comms' && <SecureComms />}
                            </div>
                        </main>
                    </div>
                    <div className="h-6 bg-zinc-900 border-t border-zinc-800 flex items-center overflow-hidden relative z-30">
                        <div className="px-4 text-[9px] font-mono text-red-500 bg-zinc-950 border-r border-zinc-800 h-full flex items-center z-10 shrink-0">ALERT FEED</div>
                        <div className="ticker-content whitespace-nowrap text-[9px] font-mono text-zinc-500 flex gap-12 px-4"><span>/// KESSEL UPRISING CONTAINMENT FAILED ///</span><span>/// NEW REPUBLIC FLEET SIGHTED IN SECTOR 5 ///</span><span>/// DIRECTOR KRASK APPROVES BUDGET INCREASE ///</span><span>/// HOK MINING GUILD DECLARED UNLAWFUL ASSEMBLY ///</span><span>/// GRAND MOFF KESSLER REQUESTS AUDIENCE ///</span><span>/// COMPNOR REVIEW PENDING ///</span></div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
